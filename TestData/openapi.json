{"openapi":"3.1.0","info":{"title":"Web Defect Detection API","version":"0.1.0"},"paths":{"/health":{"get":{"summary":"Healthcheck","description":"健康检查接口，用于判断服务是否存活及数据库大致状态。","operationId":"healthcheck_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HealthStatus"}}}}}}},"/api/steels":{"get":{"summary":"Api List Steels","operationId":"api_list_steels_api_steels_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":500,"minimum":1,"default":20,"title":"Limit"}},{"name":"defect_only","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"Defect Only"}},{"name":"start_seq","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"description":"Start seqNo (exclusive)","title":"Start Seq"},"description":"Start seqNo (exclusive)"},{"name":"order","in":"query","required":false,"schema":{"type":"string","pattern":"^(asc|desc)$","default":"desc","title":"Order"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UiSteelListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/steels/search":{"get":{"summary":"Api Search Steels","operationId":"api_search_steels_api_steels_search_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":500,"minimum":1,"default":20,"title":"Limit"}},{"name":"seq_no","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"description":"流水号精确匹配","title":"Seq No"},"description":"流水号精确匹配"},{"name":"steel_no","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"钢板号模糊匹配","title":"Steel No"},"description":"钢板号模糊匹配"},{"name":"date_from","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"description":"起始时间（含）","title":"Date From"},"description":"起始时间（含）"},{"name":"date_to","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"description":"结束时间（含）","title":"Date To"},"description":"结束时间（含）"},{"name":"order","in":"query","required":false,"schema":{"type":"string","pattern":"^(asc|desc)$","default":"desc","title":"Order"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UiSteelListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/defects/{seq_no}":{"get":{"summary":"Api Defects","operationId":"api_defects_api_defects__seq_no__get","parameters":[{"name":"seq_no","in":"path","required":true,"schema":{"type":"integer","title":"Seq No"}},{"name":"surface","in":"query","required":false,"schema":{"anyOf":[{"type":"string","pattern":"^(top|bottom)$"},{"type":"null"}],"title":"Surface"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UiDefectResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/defect-classes":{"get":{"summary":"Api Defect Classes","description":"返回缺陷字典定义（读取 configs/DefectClass.json）。","operationId":"api_defect_classes_api_defect_classes_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/images/frame":{"get":{"summary":"Api Frame Image","description":"获取单帧图像，支持指定上下表面、视角与目标尺寸。","operationId":"api_frame_image_api_images_frame_get","parameters":[{"name":"surface","in":"query","required":true,"schema":{"type":"string","pattern":"^(top|bottom)$","title":"Surface"}},{"name":"seq_no","in":"query","required":true,"schema":{"type":"integer","title":"Seq No"}},{"name":"image_index","in":"query","required":true,"schema":{"type":"integer","minimum":0,"title":"Image Index"}},{"name":"width","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","maximum":8192,"minimum":1},{"type":"null"}],"title":"Width"}},{"name":"height","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","maximum":8192,"minimum":1},{"type":"null"}],"title":"Height"}},{"name":"view","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"View"}},{"name":"fmt","in":"query","required":false,"schema":{"type":"string","default":"JPEG","title":"Fmt"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/images/defect/{defect_id}":{"get":{"summary":"Api Defect Crop","description":"按缺陷 ID 裁剪缺陷区域，并在响应头返回缺陷元数据。","operationId":"api_defect_crop_api_images_defect__defect_id__get","parameters":[{"name":"defect_id","in":"path","required":true,"schema":{"type":"integer","title":"Defect Id"}},{"name":"surface","in":"query","required":true,"schema":{"type":"string","pattern":"^(top|bottom)$","title":"Surface"}},{"name":"expand","in":"query","required":false,"schema":{"type":"integer","maximum":512,"minimum":0,"default":0,"title":"Expand"}},{"name":"width","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","maximum":4096,"minimum":1},{"type":"null"}],"title":"Width"}},{"name":"height","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","maximum":4096,"minimum":1},{"type":"null"}],"title":"Height"}},{"name":"fmt","in":"query","required":false,"schema":{"type":"string","default":"JPEG","title":"Fmt"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/images/crop":{"get":{"summary":"Api Custom Crop","description":"按自定义坐标裁剪指定帧，支持扩展边界及输出尺寸。","operationId":"api_custom_crop_api_images_crop_get","parameters":[{"name":"surface","in":"query","required":true,"schema":{"type":"string","pattern":"^(top|bottom)$","title":"Surface"}},{"name":"seq_no","in":"query","required":true,"schema":{"type":"integer","title":"Seq No"}},{"name":"image_index","in":"query","required":true,"schema":{"type":"integer","title":"Image Index"}},{"name":"x","in":"query","required":true,"schema":{"type":"integer","minimum":0,"title":"X"}},{"name":"y","in":"query","required":true,"schema":{"type":"integer","minimum":0,"title":"Y"}},{"name":"w","in":"query","required":true,"schema":{"type":"integer","minimum":1,"title":"W"}},{"name":"h","in":"query","required":true,"schema":{"type":"integer","minimum":1,"title":"H"}},{"name":"expand","in":"query","required":false,"schema":{"type":"integer","maximum":512,"minimum":0,"default":0,"title":"Expand"}},{"name":"width","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","maximum":4096,"minimum":1},{"type":"null"}],"title":"Width"}},{"name":"height","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","maximum":4096,"minimum":1},{"type":"null"}],"title":"Height"}},{"name":"fmt","in":"query","required":false,"schema":{"type":"string","default":"JPEG","title":"Fmt"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/images/mosaic":{"get":{"summary":"Api Mosaic Image","description":"生成指定序列的长带拼接图，可配置抽帧、跳过数量和尺寸。","operationId":"api_mosaic_image_api_images_mosaic_get","parameters":[{"name":"surface","in":"query","required":true,"schema":{"type":"string","pattern":"^(top|bottom)$","title":"Surface"}},{"name":"seq_no","in":"query","required":true,"schema":{"type":"integer","title":"Seq No"}},{"name":"view","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"View"}},{"name":"limit","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","maximum":10000,"minimum":1},{"type":"null"}],"title":"Limit"}},{"name":"skip","in":"query","required":false,"schema":{"type":"integer","minimum":0,"default":0,"title":"Skip"}},{"name":"stride","in":"query","required":false,"schema":{"type":"integer","minimum":1,"default":1,"title":"Stride"}},{"name":"width","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","minimum":1},{"type":"null"}],"title":"Width"}},{"name":"height","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","minimum":1},{"type":"null"}],"title":"Height"}},{"name":"fmt","in":"query","required":false,"schema":{"type":"string","default":"JPEG","title":"Fmt"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/images/tile":{"get":{"summary":"Api Tile Image","description":"按瓦片信息返回拼接图的分块，便于大图分片加载。","operationId":"api_tile_image_api_images_tile_get","parameters":[{"name":"surface","in":"query","required":true,"schema":{"type":"string","pattern":"^(top|bottom)$","title":"Surface"}},{"name":"seq_no","in":"query","required":true,"schema":{"type":"integer","title":"Seq No"}},{"name":"view","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"View"}},{"name":"level","in":"query","required":false,"schema":{"type":"integer","maximum":2,"minimum":0,"default":0,"title":"Level"}},{"name":"tile_x","in":"query","required":true,"schema":{"type":"integer","minimum":0,"title":"Tile X"}},{"name":"tile_y","in":"query","required":true,"schema":{"type":"integer","minimum":0,"title":"Tile Y"}},{"name":"tile_size","in":"query","required":false,"schema":{"type":"integer","maximum":4096,"minimum":64,"default":1024,"title":"Tile Size"}},{"name":"fmt","in":"query","required":false,"schema":{"type":"string","default":"JPEG","title":"Fmt"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/meta":{"get":{"summary":"Api Meta","description":"Web UI 全局元信息。\n\n- defect_classes: 缺陷字典（原 /api/defect-classes 返回值）\n- tile: 瓦片相关全局配置，由服务端统一给出","operationId":"api_meta_api_meta_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/steel-meta/{seq_no}":{"get":{"summary":"Api Steel Meta","description":"返回指定钢板在当前实例下的图像元数据，指导前端渲染（分布图、瓦片加载等）。","operationId":"api_steel_meta_api_steel_meta__seq_no__get","parameters":[{"name":"seq_no","in":"path","required":true,"schema":{"type":"integer","title":"Seq No"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"DatabaseStatus":{"properties":{"connected":{"type":"boolean","title":"Connected"},"latency_ms":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Latency Ms"}},"type":"object","required":["connected"],"title":"DatabaseStatus"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"HealthStatus":{"properties":{"status":{"type":"string","enum":["healthy","unhealthy"],"title":"Status"},"timestamp":{"type":"string","format":"date-time","title":"Timestamp"},"version":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Version"},"database":{"anyOf":[{"$ref":"#/components/schemas/DatabaseStatus"},{"type":"null"}]}},"type":"object","required":["status","timestamp"],"title":"HealthStatus"},"SurfaceImageInfo":{"properties":{"surface":{"type":"string","enum":["top","bottom"],"title":"Surface"},"frame_count":{"type":"integer","title":"Frame Count","description":"该表面可用帧图像数量"},"image_width":{"type":"integer","title":"Image Width","description":"单帧图像宽度（像素）"},"image_height":{"type":"integer","title":"Image Height","description":"单帧图像高度（像素）"}},"type":"object","required":["surface","frame_count","image_width","image_height"],"title":"SurfaceImageInfo","description":"按表面划分的帧图像元数据，用于前端绘制缺陷分布图。"},"UiDefectItem":{"properties":{"defect_id":{"type":"string","title":"Defect Id"},"defect_type":{"type":"string","title":"Defect Type"},"severity":{"type":"string","enum":["low","medium","high"],"title":"Severity"},"x":{"type":"integer","title":"X"},"y":{"type":"integer","title":"Y"},"width":{"type":"integer","title":"Width"},"height":{"type":"integer","title":"Height"},"confidence":{"type":"number","title":"Confidence"},"surface":{"type":"string","enum":["top","bottom"],"title":"Surface"},"image_index":{"type":"integer","title":"Image Index"}},"type":"object","required":["defect_id","defect_type","severity","x","y","width","height","confidence","surface","image_index"],"title":"UiDefectItem","description":"Web UI 专用的缺陷信息模型，字段命名与前端 Raw 类型一致。"},"UiDefectResponse":{"properties":{"seq_no":{"type":"integer","title":"Seq No"},"defects":{"items":{"$ref":"#/components/schemas/UiDefectItem"},"type":"array","title":"Defects"},"total_count":{"type":"integer","title":"Total Count"},"surface_images":{"anyOf":[{"items":{"$ref":"#/components/schemas/SurfaceImageInfo"},"type":"array"},{"type":"null"}],"title":"Surface Images"}},"type":"object","required":["seq_no","defects","total_count"],"title":"UiDefectResponse"},"UiSteelItem":{"properties":{"seq_no":{"type":"integer","title":"Seq No"},"steel_no":{"type":"string","title":"Steel No"},"steel_type":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Steel Type"},"length":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Length"},"width":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Width"},"thickness":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Thickness"},"timestamp":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Timestamp"},"level":{"type":"string","enum":["A","B","C","D"],"title":"Level","default":"D"},"defect_count":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Defect Count"}},"type":"object","required":["seq_no","steel_no"],"title":"UiSteelItem","description":"Web UI 专用的钢板信息模型，字段命名与前端 Raw 类型一致。"},"UiSteelListResponse":{"properties":{"steels":{"items":{"$ref":"#/components/schemas/UiSteelItem"},"type":"array","title":"Steels"},"total":{"type":"integer","title":"Total"}},"type":"object","required":["steels","total"],"title":"UiSteelListResponse"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}